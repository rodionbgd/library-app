var X=Object.defineProperty;var T=Object.getOwnPropertySymbols;var Y=Object.prototype.hasOwnProperty,Z=Object.prototype.propertyIsEnumerable;var F=(i,l,a)=>l in i?X(i,l,{enumerable:!0,configurable:!0,writable:!0,value:a}):i[l]=a,j=(i,l)=>{for(var a in l||(l={}))Y.call(l,a)&&F(i,a,l[a]);if(T)for(var a of T(l))Z.call(l,a)&&F(i,a,l[a]);return i};import{_ as z,d as G,u as H,r as J,a as A,c as m,w as ee,b as te,o as x,e as w,f as s,g as N,v as U,h as r,n as B,i as C,j as Q,k as L,l as ae,m as oe,F as re,p as se,q as M,R as ne,s as ue,t as le,x as de,A as P,y as ie}from"./index.ef3d6486.js";const ce={class:"d-flex"},he={class:"d-flex mw-90 author-input"},_e=["onKeyup"],pe=["disabled","onKeyup"],me=["disabled","onKeyup"],ye={class:"d-flex"},ve=G({props:{author:null,authors:null},emits:["update-author","remove-author"],setup(i,{emit:l}){var p,g,o,n,_,K;const a=i,V=H(),e=J({name:(g=(p=a.author)==null?void 0:p.name)!=null?g:"",birth_year:(n=(o=a.author)==null?void 0:o.birth_year)!=null?n:"",death_year:(K=(_=a.author)==null?void 0:_.death_year)!=null?K:""}),t=A(),c=A(!0),y=A(!0),v=A(!0),b=A(!1),E=m(()=>{var u,d,h;return e.name&&(e.name!==((u=a.author)==null?void 0:u.name)||e.birth_year!==((d=a.author)==null?void 0:d.birth_year)||e.death_year!==((h=a.author)==null?void 0:h.death_year))});ee(()=>e.name,()=>{var u,d,h,S;c.value=!!(!e.name&&!e.birth_year&&!e.death_year||e.name&&!((u=a.authors)!=null&&u.find(W=>W===e.name))),b.value=!1,c.value&&e.name!==((d=a.author)==null?void 0:d.name)&&e.name in V.state.authors&&(e.birth_year=(h=V.state.authors[e.name])==null?void 0:h.birth_year,e.death_year=(S=V.state.authors[e.name])==null?void 0:S.death_year,b.value=!0)});const f=u=>u!==""&&!Number.isNaN(+u),$=m(()=>e.birth_year===""&&e.death_year==="");te(()=>{y.value=$.value||f(`${e.birth_year}`)&&(e.death_year!==""&&(!f(`${e.death_year}`)||+e.birth_year<e.death_year)||e.death_year===""),v.value=e.birth_year!==""&&(e.death_year===""||f(`${e.death_year}`)&&+e.death_year>=e.birth_year)||$.value});const I=u=>{switch(u){case"birth_year":return y.value;case"death_year":return v.value;case"name":return c.value;default:return!0}},D=m(()=>!Object.keys(e).some(u=>!I(u))),k=()=>{if(!E.value||!D.value)return;const u={name:e.name,birth_year:e.birth_year,death_year:e.death_year};l("update-author",u),a.author&&!Object.keys(a.author).length&&Object.keys(e).forEach(d=>{e[d]="",t.value&&t.value.focus()})},O=()=>{l("remove-author")};return(u,d)=>(x(),w("div",ce,[s("div",he,[N(s("input",{ref_key:"authorEl",ref:t,type:"text",class:B(["form-control",{error:!c.value}]),placeholder:"+Add Author name","onUpdate:modelValue":d[0]||(d[0]=h=>r(e).name=h),onKeyup:C(k,["enter"])},null,42,_e),[[U,r(e).name]]),N(s("input",{type:"text",class:B(["form-control author-date",{error:!y.value}]),placeholder:"+Add Birth year",disabled:b.value,"onUpdate:modelValue":d[1]||(d[1]=h=>r(e).birth_year=h),onKeyup:C(k,["enter"])},null,42,pe),[[U,r(e).birth_year]]),N(s("input",{type:"text",class:B(["form-control author-date",{error:!v.value}]),placeholder:"+Add Death year",disabled:b.value,"onUpdate:modelValue":d[2]||(d[2]=h=>r(e).death_year=h),onKeyup:C(k,["enter"])},null,42,me),[[U,r(e).death_year]])]),s("div",ye,[a.author&&Object.keys(a.author).length&&a.authors.length>1?(x(),w("button",{key:0,type:"button",class:"edit-btn",onClick:O,onKeyup:d[3]||(d[3]=C(Q(()=>{},["prevent"]),["enter"]))}," - ",32)):L("",!0),r(E)&&r(D)?(x(),w("button",{key:1,type:"button",class:"edit-btn",onClick:k}," + ")):L("",!0)])]))}});var q=z(ve,[["__scopeId","data-v-c2a29668"]]);const R=i=>(ue("data-v-7d2af07c"),i=i(),le(),i),be={class:"box"},fe={class:"modal__text"},ke={class:"form-group"},Ae=R(()=>s("p",{class:"modal__title"},"Title",-1)),xe=R(()=>s("p",null,"Price",-1)),Be=R(()=>s("p",{class:"modal__title"},"Authors",-1)),Ve={class:"d-flex justify-content-center mt-2"},Ee=["disabled"],$e=G({props:{bookId:null},setup(i){const l=i,a=H(),V=de(),e={id:-1,title:"",price:void 0,rate:0,formats:{"image/jpeg":""},authors:[]},t=J(e),c=m(()=>{var o;return(o=a.state.books.books.find(n=>n.id===l.bookId))!=null?o:e}),y=A(!1),v=()=>{var o;t.title=c.value.title,t.price=c.value.price,t.rate=(o=c.value.rate)!=null?o:1,c.value.authors&&(t.authors=[...c.value.authors])},b=()=>{const o={authors:t.authors,title:t.title,price:t.price,rate:t.rate};l.bookId>a.state.books.lastBookId?a.dispatch(`books/${P.ADD_BOOK}`,o):a.dispatch(`books/${P.UPDATE_BOOK}`,j(j({},c.value),o)),y.value=!0,p()},E=m(()=>t.price&&!Number.isNaN(+t.price)),f=m(()=>t.title&&E.value&&t.authors.length),$=m(()=>{var o;return(o=t.authors)==null?void 0:o.map(n=>n.name)}),I=(o,n)=>{n!==void 0&&(t.authors[n]=o)},D=o=>{t.authors=t.authors.filter(n=>n.name!==o)},k=o=>{!Object.keys(o).length||(t.authors=[...t.authors,o],t.authors=[...t.authors])},O=o=>{t.rate=o};ae(()=>{document.body.addEventListener("keydown",g),v()}),oe(()=>{document.body.removeEventListener("keydown",g)});const p=()=>{y.value||v(),V.back()},g=o=>{o.code==="Escape"&&(p(),o.preventDefault())};return(o,n)=>(x(),w("div",be,[s("div",{class:"modal-container",onClick:p},[s("div",{class:"modal-custom",onClick:n[2]||(n[2]=Q(()=>{},["stop"]))},[s("div",fe,[s("form",null,[s("div",ke,[Ae,N(s("input",{"data-test":"title",type:"text",class:B(["form-control",{error:!r(t).title}]),"onUpdate:modelValue":n[0]||(n[0]=_=>r(t).title=_)},null,2),[[U,r(t).title]]),xe,N(s("input",{"data-test":"price",type:"text",class:B(["form-control",{error:!r(E)}]),"onUpdate:modelValue":n[1]||(n[1]=_=>r(t).price=_)},null,2),[[U,r(t).price]]),Be,(x(!0),w(re,null,se(r(t).authors,(_,K)=>(x(),ie(q,{class:"d-flex",author:_,authors:r($),key:_.name,onUpdateAuthor:u=>I(u,K),onRemoveAuthor:u=>D(_.name)},null,8,["author","authors","onUpdateAuthor","onRemoveAuthor"]))),128)),M(q,{class:"d-flex",type:"text",authors:r($),author:{},onUpdateAuthor:k},null,8,["authors"])]),s("div",null,[M(ne,{onUpdateRate:O,rate:r(t).rate},null,8,["rate"])])])]),s("div",Ve,[s("button",{class:B(["modal__btn",{"opacity-50":!r(f)}]),onClick:b,disabled:!r(f)}," Save book ",10,Ee)]),s("button",{class:"modal__btn link-2 mt-3rem",onClick:p})])])]))}});var Ne=z($e,[["__scopeId","data-v-7d2af07c"]]);export{Ne as default};
