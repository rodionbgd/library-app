import{_ as T,d as L,u as P,r as Y,a as k,c as p,w as H,b as J,o as g,e as z,f as r,g as $,v as U,h as o,n as x,i as D,j as q,k as C,l as Q,m as W,F as X,p as Z,q as R,R as ee,s as te,t as ae,x as oe,A as F,y as re}from"./index.5e67c1c0.js";const se={class:"d-flex"},de={class:"d-flex mw-90 author-input"},ne=["onKeyup"],ie=["disabled","onKeyup"],le=["disabled","onKeyup"],ue={class:"d-flex"},ce=L({props:{author:null,authors:null},emits:["update-author","remove-author"],setup(h,{emit:w}){var m,E,a,d,c,N;const s=h,A=P(),e=Y({name:(E=(m=s.author)==null?void 0:m.name)!=null?E:"",birth_year:(d=(a=s.author)==null?void 0:a.birth_year)!=null?d:"",death_year:(N=(c=s.author)==null?void 0:c.death_year)!=null?N:""}),t=k(),l=k(!0),v=k(!0),_=k(!0),b=k(!1),B=p(()=>{var n,i,u;return e.name&&(e.name!==((n=s.author)==null?void 0:n.name)||e.birth_year!==((i=s.author)==null?void 0:i.birth_year)||e.death_year!==((u=s.author)==null?void 0:u.death_year))});H(()=>e.name,()=>{var n,i,u,S;l.value=!!(!e.name&&!e.birth_year&&!e.death_year||e.name&&!((n=s.authors)!=null&&n.find(G=>G===e.name))),b.value=!1,l.value&&e.name!==((i=s.author)==null?void 0:i.name)&&e.name in A.state.authors&&(e.birth_year=(u=A.state.authors[e.name])==null?void 0:u.birth_year,e.death_year=(S=A.state.authors[e.name])==null?void 0:S.death_year,b.value=!0)});const y=n=>n!==""&&!Number.isNaN(+n),V=p(()=>e.birth_year===""&&e.death_year==="");J(()=>{v.value=V.value||y(`${e.birth_year}`)&&(e.death_year!==""&&(!y(`${e.death_year}`)||+e.birth_year<e.death_year)||e.death_year===""),_.value=e.birth_year!==""&&(e.death_year===""||y(`${e.death_year}`)&&+e.death_year>=e.birth_year)||V.value});const I=n=>{switch(n){case"birth_year":return v.value;case"death_year":return _.value;case"name":return l.value;default:return!0}},j=p(()=>!Object.keys(e).some(n=>!I(n))),f=()=>{if(!B.value||!j.value)return;const n={name:e.name,birth_year:e.birth_year,death_year:e.death_year};w("update-author",n),s.author&&!Object.keys(s.author).length&&Object.keys(e).forEach(i=>{e[i]="",t.value&&t.value.focus()})},K=()=>{w("remove-author")};return(n,i)=>(g(),z("div",se,[r("div",de,[$(r("input",{ref_key:"authorEl",ref:t,type:"text",class:x(["form-control",{error:!l.value}]),placeholder:"+Add Author name","onUpdate:modelValue":i[0]||(i[0]=u=>o(e).name=u),onKeyup:D(f,["enter"])},null,42,ne),[[U,o(e).name]]),$(r("input",{type:"text",class:x(["form-control author-date",{error:!v.value}]),placeholder:"+Add Birth year",disabled:b.value,"onUpdate:modelValue":i[1]||(i[1]=u=>o(e).birth_year=u),onKeyup:D(f,["enter"])},null,42,ie),[[U,o(e).birth_year]]),$(r("input",{type:"text",class:x(["form-control author-date",{error:!_.value}]),placeholder:"+Add Death year",disabled:b.value,"onUpdate:modelValue":i[2]||(i[2]=u=>o(e).death_year=u),onKeyup:D(f,["enter"])},null,42,le),[[U,o(e).death_year]])]),r("div",ue,[s.author&&Object.keys(s.author).length&&s.authors.length>1?(g(),z("button",{key:0,type:"button",class:"edit-btn",onClick:K,onKeyup:i[3]||(i[3]=D(q(()=>{},["prevent"]),["enter"]))}," - ",32)):C("",!0),o(B)&&o(j)?(g(),z("button",{key:1,type:"button",class:"edit-btn",onClick:f}," + ")):C("",!0)])]))}});var M=T(ce,[["__scopeId","data-v-c2a29668"]]);const O=h=>(te("data-v-3a2d8390"),h=h(),ae(),h),he={class:"box"},me={class:"modal__text"},pe={class:"form-group"},ve=O(()=>r("p",{class:"modal__title"},"Title",-1)),_e=O(()=>r("p",null,"Price",-1)),be=O(()=>r("p",{class:"modal__title"},"Authors",-1)),ye={class:"d-flex justify-content-center mt-2"},fe=["disabled"],ke=L({props:{bookId:null},setup(h){const w=h,s=P(),A=oe(),e={id:-1,title:"",price:void 0,rate:0,formats:{"image/jpeg":""},authors:[]},t=Y(e),l=p(()=>{var a;return(a=s.state.books.books.find(d=>d.id===w.bookId))!=null?a:e}),v=k(!1),_=()=>{var a;t.title=l.value.title,t.price=l.value.price,t.rate=(a=l.value.rate)!=null?a:1,l.value.authors&&(t.authors=[...l.value.authors])},b=()=>{const a={authors:t.authors,title:t.title,price:t.price,rate:t.rate};w.bookId>s.state.books.lastBookId?s.dispatch(`books/${F.ADD_BOOK}`,a):s.dispatch(`books/${F.UPDATE_BOOK}`,{...l.value,...a}),v.value=!0,m()},B=p(()=>t.price&&!Number.isNaN(+t.price)),y=p(()=>t.title&&B.value&&t.authors.length),V=p(()=>{var a;return(a=t.authors)==null?void 0:a.map(d=>d.name)}),I=(a,d)=>{d!==void 0&&(t.authors[d]=a)},j=a=>{t.authors=t.authors.filter(d=>d.name!==a)},f=a=>{!Object.keys(a).length||(t.authors=[...t.authors,a])},K=a=>{t.rate=a};Q(()=>{document.body.addEventListener("keydown",E),_()}),W(()=>{document.body.removeEventListener("keydown",E)});const m=()=>{v.value||_(),A.back()},E=a=>{a.code==="Escape"&&(m(),a.preventDefault())};return(a,d)=>(g(),z("div",he,[r("div",{class:"modal-container",onClick:m},[r("div",{class:"modal-custom",onClick:d[2]||(d[2]=q(()=>{},["stop"]))},[r("div",me,[r("form",null,[r("div",pe,[ve,$(r("input",{"data-test":"title",type:"text",class:x(["form-control",{error:!o(t).title}]),"onUpdate:modelValue":d[0]||(d[0]=c=>o(t).title=c)},null,2),[[U,o(t).title]]),_e,$(r("input",{"data-test":"price",type:"text",class:x(["form-control",{error:!o(B)}]),"onUpdate:modelValue":d[1]||(d[1]=c=>o(t).price=c)},null,2),[[U,o(t).price]]),be,(g(!0),z(X,null,Z(o(t).authors,(c,N)=>(g(),re(M,{class:"d-flex",author:c,authors:o(V),key:c.name,onUpdateAuthor:n=>I(n,N),onRemoveAuthor:n=>j(c.name)},null,8,["author","authors","onUpdateAuthor","onRemoveAuthor"]))),128)),R(M,{class:"d-flex",type:"text",authors:o(V),author:{},onUpdateAuthor:f},null,8,["authors"])]),r("div",null,[R(ee,{onUpdateRate:K,rate:o(t).rate},null,8,["rate"])])])]),r("div",ye,[r("button",{class:x(["modal__btn",{"opacity-50":!o(y)}]),onClick:b,disabled:!o(y)}," Save book ",10,fe)]),r("button",{class:"modal__btn link-2 mt-3rem",onClick:m})])])]))}});var xe=T(ke,[["__scopeId","data-v-3a2d8390"]]);export{xe as default};
