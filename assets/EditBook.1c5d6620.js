var H=Object.defineProperty;var K=Object.getOwnPropertySymbols;var J=Object.prototype.hasOwnProperty,Q=Object.prototype.propertyIsEnumerable;var S=(n,d,o)=>d in n?H(n,d,{enumerable:!0,configurable:!0,writable:!0,value:o}):n[d]=o,U=(n,d)=>{for(var o in d||(d={}))J.call(d,o)&&S(n,o,d[o]);if(K)for(var o of K(d))Q.call(d,o)&&S(n,o,d[o]);return n};import{_ as q,u as F,r as L,a as N,c as m,w as W,o as v,b as x,d as s,e as A,v as B,f as u,n as $,g,h as M,i as R,p as T,j as z,k as X,l as Y,F as Z,m as ee,q as D,R as te,s as ae,t as oe}from"./index.5e5a8a69.js";const P=n=>(T("data-v-59e89c6a"),n=n(),z(),n),re={class:"d-flex"},se={class:"d-flex mw-100 author-input"},ne=["onKeyup"],ue=["disabled","onKeyup"],de=["disabled","onKeyup"],le={class:"mh-0"},ie=P(()=>s("i",{class:"fa-regular fa-trash-can"},null,-1)),ce=[ie],he=P(()=>s("i",{class:"fa-regular fa-pen-to-square"},null,-1)),_e=[he],pe={props:{author:{type:Object,default:()=>({})},authors:{type:Array,default:()=>[]}},emits:{"update-author":null,"remove-author":null},setup(n,{emit:d}){var V,_,k;const o=n,b=F(),e=L({name:(V=o.author.name)!=null?V:"",birth_year:(_=o.author.birth_year)!=null?_:"",death_year:(k=o.author.death_year)!=null?k:""}),a=N(null),i=m(()=>e.name&&(e.name!==o.author.name||e.birth_year!==o.author.birth_year||e.death_year!==o.author.death_year)),c=N(!0),h=N(!1),w=m(()=>!Object.keys(e).some(t=>!f(t)));W(()=>e.name,()=>{c.value=!e.name&&!e.birth_year&&!e.death_year||e.name&&!o.authors.find(t=>t===e.name),h.value=!1,c.value&&e.name!==o.author.name&&e.name in b.state.authors&&(e.birth_year=b.state.authors[e.name].birth_year,e.death_year=b.state.authors[e.name].death_year,h.value=!0)});const E=m(()=>e.birth_year===""&&e.death_year===""),p=t=>t!==""&&!Number.isNaN(+t),f=t=>{switch(t){case"birth_year":return E.value||p(e.birth_year)&&(e.death_year!==""&&(!p(e.death_year)||+e.birth_year<e.death_year)||e.death_year==="");case"death_year":return e.birth_year!==""&&(e.death_year===""||p(+e.death_year)&&e.death_year>=e.birth_year)||e.birth_year===""&&e.death_year==="";case"name":return c.value;default:return!0}},y=()=>{if(!i.value)return;const t={name:e.name,birth_year:e.birth_year,death_year:e.death_year};d("update-author",t),Object.keys(o.author).length||Object.keys(e).forEach(r=>{e[`${r}`]="",a.value.focus()})},I=()=>{d("remove-author")};return(t,r)=>(v(),x("div",re,[s("div",se,[A(s("input",{ref_key:"authorEl",ref:a,type:"text",class:$(["form-control",{error:!c.value}]),placeholder:"+Add Author name","onUpdate:modelValue":r[0]||(r[0]=l=>u(e).name=l),onKeyup:g(y,["enter"])},null,42,ne),[[B,u(e).name]]),A(s("input",{type:"text",class:$(["form-control author-date",{error:!f("birth_year")}]),placeholder:"+Add Birth year",disabled:h.value,"onUpdate:modelValue":r[1]||(r[1]=l=>u(e).birth_year=l),onKeyup:g(y,["enter"])},null,42,ue),[[B,u(e).birth_year]]),A(s("input",{type:"text",class:$(["form-control author-date",{error:!f("death_year")}]),placeholder:"+Add Death year",disabled:h.value,"onUpdate:modelValue":r[2]||(r[2]=l=>u(e).death_year=l),onKeyup:g(y,["enter"])},null,42,de),[[B,u(e).death_year]])]),s("div",le,[Object.keys(o.author).length&&o.authors.length>1?(v(),x("button",{key:0,type:"button",class:"edit-btn",onClick:I,onKeyup:r[3]||(r[3]=g(M(()=>{},["prevent"]),["enter"]))},ce,32)):R("",!0),u(i)&&u(w)?(v(),x("button",{key:1,class:"edit-btn",onClick:y},_e)):R("",!0)])]))}};var O=q(pe,[["__scopeId","data-v-59e89c6a"]]);const j=n=>(T("data-v-c8e088da"),n=n(),z(),n),ye={class:"box"},me={class:"modal__text"},ve={class:"form-group"},be=j(()=>s("p",{class:"modal__title"},"Title",-1)),fe=j(()=>s("p",null,"Price",-1)),ke=j(()=>s("p",{class:"modal__title"},"Authors",-1)),xe={class:"d-flex justify-content-center mt-2"},Ae=["disabled"],Be={props:{bookId:{type:Number,required:!0}},setup(n){const d=n,o=F(),b=ae(),e={title:"",price:"",rate:0,authors:[]},a=L(e),i=m(()=>{var t;return(t=o.state.books.find(r=>r.id===d.bookId))!=null?t:e}),c=N(!1),h=()=>{var t;a.title=i.value.title,a.price=i.value.price,a.rate=(t=i.value.rate)!=null?t:1,i.value.authors&&(a.authors=[...i.value.authors])},w=()=>{const t={authors:a.authors,title:a.title,price:a.price,rate:a.rate};d.bookId>o.state.lastBookId?o.dispatch("addBook",t):o.dispatch("updateBook",U(U({},i.value),t)),c.value=!0,_()},E=m(()=>a.title&&a.price&&!Number.isNaN(+a.price)&&a.authors.length),p=m(()=>{var t;return(t=a.authors)==null?void 0:t.map(r=>r.name)}),f=(t,r)=>{r!==void 0&&(a.authors[r]=t)},y=t=>{a.authors=a.authors.filter(r=>r.name!==t)},I=t=>{!Object.keys(t).length||(a.authors=[...a.authors,t])},V=t=>{a.rate=t};X(()=>{document.body.addEventListener("keydown",k),h()}),Y(()=>{document.body.removeEventListener("keydown",k)});const _=()=>{c.value||h(),b.back()},k=t=>{t.code==="Escape"&&(_(),t.preventDefault())};return(t,r)=>(v(),x("div",ye,[s("div",{class:"modal-container",onClick:_},[s("div",{class:"modal-custom",onClick:r[2]||(r[2]=M(()=>{},["stop"]))},[s("div",me,[s("form",null,[s("div",ve,[be,A(s("input",{"data-test":"title",type:"text",class:"form-control","onUpdate:modelValue":r[0]||(r[0]=l=>u(a).title=l)},null,512),[[B,u(a).title]]),fe,A(s("input",{"data-test":"price",type:"text",class:"form-control","onUpdate:modelValue":r[1]||(r[1]=l=>u(a).price=l)},null,512),[[B,u(a).price]]),ke,(v(!0),x(Z,null,ee(u(a).authors,(l,G)=>(v(),oe(O,{class:"d-flex",author:l,authors:u(p),key:l.name,onUpdateAuthor:C=>f(C,G),onRemoveAuthor:C=>y(l.name)},null,8,["author","authors","onUpdateAuthor","onRemoveAuthor"]))),128)),D(O,{class:"d-flex",type:"text",authors:u(p),onUpdateAuthor:I},null,8,["authors"])]),s("div",null,[D(te,{onUpdateRate:V,rate:u(a).rate},null,8,["rate"])])])]),s("div",xe,[s("button",{class:$(["modal__btn",{"opacity-50":!u(E)}]),onClick:w,disabled:!u(E)}," Save book ",10,Ae)]),s("button",{class:"modal__btn link-2 mt-3rem",onClick:_})])])]))}};var ge=q(Be,[["__scopeId","data-v-c8e088da"]]);export{ge as default};
